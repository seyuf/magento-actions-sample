!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jquery"),require("mage/translate")):"function"==typeof define&&define.amd?define(["jquery","mage/translate"],e):"object"==typeof exports?exports["magesuite-store-locator"]=e(require("jquery"),require("mage/translate")):t["magesuite-store-locator"]=e(t.jquery,t["mage/translate"])}(window,function(t,e){return function(t){function e(e){for(var s,n,a=e[0],l=e[1],p=e[2],h=0,d=[];h<a.length;h++)n=a[h],r[n]&&d.push(r[n][0]),r[n]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);for(c&&c(e);d.length;)d.shift()();return i.push.apply(i,p||[]),o()}function o(){for(var t,e=0;e<i.length;e++){for(var o=i[e],s=!0,a=1;a<o.length;a++){var l=o[a];0!==r[l]&&(s=!1)}s&&(i.splice(e--,1),t=n(n.s=o[0]))}return t}var s={},r={11:0},i=[];function n(e){if(s[e])return s[e].exports;var o=s[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=s,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(o,s,function(e){return t[e]}.bind(null,s));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="";var a=window.webpackJsonp_name_=window.webpackJsonp_name_||[],l=a.push.bind(a);a.push=e,a=a.slice();for(var p=0;p<a.length;p++)e(a[p]);var c=l;return i.push([270,0]),o()}({0:function(e,o){e.exports=t},270:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o(271);var s=o(272),r=o(0);r(".cs-store-locator").length&&new s.default(r(".cs-store-locator"))},271:function(t,e,o){},272:function(t,e,o){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var r=o(0);o(4);var i=o(273),n=o(274),a=o(1),l=function(){function t(t,e){var o=this;this._options={mapStartPoint:{lat:52,lng:9},basicZoom:14,initialZoom:7,useDefaultMapStyles:!1,markerIcons:{pin:{sizes:{x:18,y:25}},pinAlt:{sizes:{x:18,y:25}},pinActive:{sizes:{x:18,y:25}},userLocation:{sizes:{x:25,y:25}}},clusterStyles:{url:"",height:22,width:22,textSize:12,textColor:"#fff",backgroundPosition:"center"}},this._sidebarClosed=!1,this._mobilePopupOpen=!1,this._sidebarMobileOpen=!1,this._mapMobileHidden=!1,this.stores=[],this._allItemsRendered=!1,this._$element=t||r(".cs-store-locator"),this._options=r.extend(this._options,e),this._$sidebarToggler=this._$element.find(".cs-store-locator__sidebar-toggler"),this._$locationButton=this._$element.find(".cs-store-locator__location-button"),this._$searchButton=this._$element.find(".cs-store-locator__search-button"),this._$searchForm=this._$element.find(".cs-store-locator__search-form"),this._$searchInput=this._$element.find(".cs-store-locator__search-input"),this._$itemsList=this._$element.find(".cs-store-locator__stores-list-inner"),r.post({url:"/graphql",data:JSON.stringify({query:"{\n                    storePickupLocations {\n                      items {\n                        name\n                        latitude\n                        longitude\n                        city\n                        street\n                        postCode\n                        description\n                        sourceCode\n                        countryId\n                      }\n                    }\n                  }"}),contentType:"application/json"}).done(function(t){o.stores=t.data.storePickupLocations.items,o._initMap()}),this._attachEvents()}return t.prototype.searchButtonClickHandler=function(){var t=this,e=r(".cs-store-locator__search-input").val();this._$searchForm.addClass("ajax-loading"),this.getCoordinatesFromQuery(e).then(function(e){if(e.data.addressLocation&&e.data.addressLocation.latitude&&e.data.addressLocation.longitude){var o={lat:e.data.addressLocation.latitude,lng:e.data.addressLocation.longitude};t.map.panTo(o),t.map.setZoom(t._options.basicZoom),o!==t._userPosition&&(t.setUserPositionAndPopulateDistance(t.stores,o),t.renderItems(t.getFilteredStores()),t._locationMarker&&t._locationMarker.setMap(null),t._locationMarker=new google.maps.Marker({position:o,map:t.map,icon:t._options.markerIcons.userLocation}))}else r(".cs-store-locator__empty-message--nolocation").remove(),t._$itemsList.prepend('<div class="cs-store-locator__empty-message cs-store-locator__empty-message--nolocation">\n                '+r.mage.__("Unfortunately we were not able to find this location.")+"</div>"),r(".cs-store-locator__empty-message--nolocation").show(),setTimeout(function(){r(".cs-store-locator__empty-message--nolocation").slideUp().remove()},5e3)})},t.prototype.setUserPositionAndPopulateDistance=function(t,e){this.stores=this.populateStoresDistance(t,e),this.stores=this.stores.sort(function(t,e){return t.distance-e.distance}),this.stores=Object.freeze(this.stores),this._userPosition=e},t.prototype.renderItems=function(t){var e=this;r(window).width()<a.default.laptop||this._allItemsRendered||(this._$itemsList.empty(),t.map(function(t,o){e._$itemsList.append(e.getInfoWindowContent(t))}),this._$element.find(".cs-store-locator__item").on("click",function(t){r(t.target).hasClass("cs-store-locator__item-hours-trigger")||e.itemClickHandler(r(t.currentTarget).attr("data-id"))}),this._$itemsList.append('<div class="cs-store-locator__empty-message">\n        '+r.mage.__("Unfortunately we do not have any stores in your area. Please zoom the map to see bigger area.")+"</div>"))},t.prototype.getFilteredStores=function(){var t=this.map.getBounds(),e=this.stores.filter(function(e){return t.contains({lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)})});return e=e.sort(function(t,e){return t.distance-e.distance})},t.prototype.locationButtonClickHandler=function(){var t=this;this.getGeolocation().then(function(e){e&&(t.map.panTo(e),t.map.setZoom(t._options.basicZoom),e!==t._userPosition&&(t._$itemsList.empty(),t._allItemsRendered=!1,t.setUserPositionAndPopulateDistance(t.stores,e),t.renderItems(t.getFilteredStores()),t._locationMarker&&t._locationMarker.setMap(null),t._locationMarker=new google.maps.Marker({position:e,map:t.map,icon:t._options.markerIcons.userLocation})))})},t.prototype.markerClickHandler=function(t,e){this.updateActiveMarkerIcon(t),this._activeStoreId=e,r(window).width()<a.default.laptop&&(this.closeMobilePopup(),this.openMobilePopup(this._activeStoreId)),this.panToStore(e)},t.prototype.itemClickHandler=function(t){if(this.markers){var e=this.markers.find(function(e){return e.get("storeId")===t});e&&this.updateActiveMarkerIcon(e)}this.panToStore(t),this._activeStoreId=t,r(window).width()<a.default.laptop&&(r(".cs-store-locator__stores-list").removeClass("cs-store-locator__stores-list--mobile-open"),this.openMobilePopup(t))},t.prototype.updateActiveMarkerIcon=function(t){this._activeMarker&&this._activeMarker.setIcon(this._options.markerIcons.pin),this._activeMarker=t,this._activeMarker.setIcon(this._options.markerIcons.pinActive)},t.prototype.panToStore=function(t){this._infoWindow.close(this.map,this._activeMarker);var e=this.stores.find(function(e){return e.sourceCode===t}),o={lat:e.latitude,lng:e.longitude},s=r(window).width()>=a.default.laptop&&!this._sidebarClosed?this.calculateCoordinatesOffset(o,14,{x:190,y:0},google,this.map):o;this.map.panTo(s),this.map.getZoom()<this._options.basicZoom&&this.map.setZoom(this._options.basicZoom),this._infoWindowOpened=!0,this._infoWindow.setContent(this.getInfoWindowContent(e)),this._infoWindow.open(this.map,this._activeMarker)},t.prototype.getInfoWindowContent=function(t){var e=t.postCode?t.postCode+" ":"",o=t.city?t.city:"",s=t.street?t.street:"",i=e||o||t.street?'<p class="cs-store-locator__item-address">\n        '+e+" "+o+", "+s+"</p>":"",n=t.description?'<p class="cs-store-locator__item-description">\n        '+t.description+"</p>":"",a=t.phone?'<a href="tel:'+t.phone+'" class="cs-store-locator__item-phone">\n        '+t.phone+"</a>":"",l=t.email?'<a href="mailto:'+t.email+'" class="cs-store-locator__item-email">\n        '+t.email+"</a>":"",p=t.distance?'<span class="cs-store-locator__item-distance">\n        '+r.mage.__("Distance")+" "+t.distance+" km</span>":"",c=t.routeLink,h=(new Date).getDay(),d="",u={mon:r.mage.__("Monday"),tue:r.mage.__("Tuesday"),wed:r.mage.__("Wednesday"),thu:r.mage.__("Thursday"),fri:r.mage.__("Friday"),sat:r.mage.__("Saturday"),sun:r.mage.__("Sunday")},_=["mon","tue","wed","thu","fri","sat","sun"];_.forEach(function(e){t[e+"_lunch_from"]&&t[e+"_lunch_to"]&&(d=d+"<li><span>"+r.mage.__(u[e])+"</span><span>"+t[e+"_lunch_from"]+" - "+t[e+"_lunch_to"]+"</span></li> ")});var m="";return t[_[h-1]+"_lunch_from"]&&t[_[h-1]+"_lunch_to"]&&(m=m+'<div class="cs-store-locator__item-hours-today">'+r.mage.__("Today")+" ("+u[_[h-1]]+") open \n                <span>"+t[_[h-1]+"_lunch_from"]+" - "+t[_[h-1]+"_lunch_to"]+"</span>\n                </div>"),d&&(d='<div class="cs-store-locator__item-hours-wrapper">\n            '+m+'\n            <div class="cs-store-locator__item-hours-trigger">'+r.mage.__("Show all opening hours")+'</div>\n                <ul class="cs-store-locator__item-hours" style="display: none;">'+d+"</ul>\n            </div>"),'<div class="cs-store-locator__item" \n            data-id="'+t.sourceCode+'" data-lat="'+t.latitude+'" data-lng="'+t.longitude+'">\n            <div class="cs-store-locator__store-details-close"></div> \n            <div class="cs-store-locator__item-content">\n                <div class="cs-store-locator__item-header">\n                    <h2 class="cs-store-locator__item-name">'+t.name+'</h2>\n                    <a href="'+c+'" target="_blank" rel="noopener noreferrer" class="cs-store-locator__item-route">\n                        <span>'+r.mage.__("Route")+"</span>\n                    </a>\n                </div> \n                "+i+"\n                "+n+"\n                "+a+"\n            </div> \n            "+d+'\n            <div class="cs-store-locator__item-footer">\n                '+l+" \n                "+p+"\n            </div>\n        </div>"},t.prototype.getGeolocation=function(){return new Promise(function(t,e){"ggeolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){t({lat:e.coords.latitude,lng:e.coords.longitude})},function(t){e(new Error("Geolocation not enabled"))}):e(new Error("Geolocation not supported"))})},t.prototype.calculateCoordinatesOffset=function(t,e,o,s,r){var i=Math.pow(2,e),n=new s.maps.Point(o.x/i||o.y,0),a=new s.maps.LatLng(t),l=r.getProjection().fromLatLngToPoint(a),p=new s.maps.Point(l.x-n.x,l.y+n.y);return r.getProjection().fromPointToLatLng(p)},t.prototype.toggleSidebar=function(){this._sidebarClosed?(r(".cs-store-locator__sidebar").removeClass("cs-store-locator__sidebar--closed"),r(".cs-store-locator__sidebar-toggler-icon").removeClass("cs-store-locator__sidebar-toggler-icon--closed")):(r(".cs-store-locator__sidebar").addClass("cs-store-locator__sidebar--closed"),r(".cs-store-locator__sidebar-toggler-icon").addClass("cs-store-locator__sidebar-toggler-icon--closed")),this._sidebarClosed=!this._sidebarClosed},t.prototype.filterItems=function(){var t=this.map.getBounds(),e=0;this._$element.find(".cs-store-locator__item").each(function(){t.contains({lat:parseFloat(r(this).attr("data-lat")),lng:parseFloat(r(this).attr("data-lng"))})?(r(this).show(),e++):r(this).hide()}),e>0?this._$element.find(".cs-store-locator__empty-message").hide():this._$element.find(".cs-store-locator__empty-message").show()},t.prototype.getCoordinatesFromQuery=function(t){return r.post({url:"/graphql",data:JSON.stringify({query:'{\n                    addressLocation (\n                        query: "'+t+'"\n                    ) {\n                        latitude\n                        longitude\n                    }\n                  }'}),contentType:"application/json"})},t.prototype.populateStoresDistance=function(t,e){var o=this;return t.map(function(t){return s({},t,{distance:o.calculateDistance(t.latitude,t.longitude,e?e.lat:t.latitude,e?e.lng:t.longitude)})})},t.prototype.closeMobilePopup=function(){r(".cs-store-locator__store-details").html(""),this._mobilePopupOpen=!1,r(".cs-store-locator__store-details").removeClass("cs-store-locator__store-details--mobile"),this._sidebarMobileOpen=!1,r(".cs-store-locator__sidebar").removeClass("cs-store-locator__sidebar--mobile-open"),this._mapMobileHidden=!1,r(".cs-store-locator__map-container").removeClass("cs-store-locator__map-container--mobile-hidden")},t.prototype.openMobileStores=function(){this._mobilePopupOpen=!1,r(".cs-store-locator__store-details").removeClass("cs-store-locator__store-details--mobile"),this._sidebarMobileOpen=!0,r(".cs-store-locator__sidebar").addClass("cs-store-locator__sidebar--mobile-open"),this._mapMobileHidden=!0,r(".cs-store-locator__map-container").addClass("cs-store-locator__map-container--mobile-hidden")},t.prototype.openMobilePopup=function(t){var e=this.stores.find(function(e){return e.sourceCode===t});r(".cs-store-locator__store-details").append(this.getInfoWindowContent(e)),this._mobilePopupOpen=!0,r(".cs-store-locator__store-details").addClass("cs-store-locator__store-details--mobile"),this._sidebarMobileOpen=!1,r(".cs-store-locator__sidebar").removeClass("cs-store-locator__sidebar--mobile-open"),this._mapMobileHidden=!1,r(".cs-store-locator__map-container").removeClass("cs-store-locator__map-container--mobile-hidden")},t.prototype.windowResizeHandler=function(){r(window).width()>=a.default.laptop&&this._mobilePopupOpen&&this.closeMobilePopup()},t.prototype.mapChangeHandler=function(){this._allItemsRendered?this.filterItems():!this._allItemsRendered&&this.getFilteredStores().length>=100?(this.renderItems(this.stores),this.filterItems(),this._allItemsRendered=!0):(this.renderItems(this.getFilteredStores()),this.filterItems())},t.prototype.zoomChangeHandler=function(){this.closeMobilePopup()},t.prototype.calculateDistance=function(t,e,o,s){var r=Math.abs(t-o)*Math.PI/180,i=Math.abs(e-s)*Math.PI/180,n=t*Math.PI/180,a=o*Math.PI/180,l=Math.sin(r/2)*Math.sin(r/2)+Math.cos(n)*Math.cos(a)*Math.sin(i/2)*Math.sin(i/2),p=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));return Number((6371*p).toFixed(2))},t.prototype._initMap=function(){var t=this,e={zoom:this._options.initialZoom,center:this._options.mapStartPoint,mapTypeControl:!1,streetViewControl:!1};this._options.useDefaultMapStyles||(e.styles=i.default),this.map=new google.maps.Map(document.getElementById("store-locator-map"),e),this._setMarkerIcons(),this._createMarkers(),this.getGeolocation().then(function(e){t.setUserPositionAndPopulateDistance(t.stores,e),t._locationMarker&&t._locationMarker.setMap(null),t._locationMarker=new google.maps.Marker({position:e,map:t.map,icon:t._options.markerIcons.userLocation}),t.map.panTo(e),t.map.setZoom(t._options.basicZoom);var o=google.maps.event.addListener(t.map,"idle",function(){t.stores.length<100?(t.renderItems(t.stores),t._attachMapListeners(),t._allItemsRendered=!0):(t.renderItems(t.getFilteredStores()),t._attachMapListeners()),google.maps.event.removeListener(o)})}).catch(function(e){t.setUserPositionAndPopulateDistance(t.stores,null);var o=google.maps.event.addListener(t.map,"idle",function(){t.renderItems(t.stores),t._attachMapListeners(),t._allItemsRendered=!0,google.maps.event.removeListener(o)})})},t.prototype._createMarkers=function(){var t=this;this.map&&(this.cluster&&this.cluster.clearMarkers(),this._infoWindow=new google.maps.InfoWindow({}),this.markers=this.stores.map(function(e){var o=new google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:t.map,icon:t._options.markerIcons.pin});return o.addListener("click",function(){t.markerClickHandler(o,e.sourceCode)}),o.set("storeId",e.sourceCode),o}),this.cluster=new n.default(this.map,this.markers,{styles:[this._options.clusterStyles]}))},t.prototype._setMarkerIcons=function(){var t=this._$element.attr("data-image-path");this._options.markerIcons.pin.url=t+"/icon-pin.png",this._options.markerIcons.pinAlt.url=t+"/icon-pin-alt.png",this._options.markerIcons.pinActive.url=t+"/icon-pin-active.png",this._options.markerIcons.userLocation.url=t+"/icon-user-marker.png",this._options.clusterStyles.url=t+"/icon-cluster.png",this._options.markerIcons.pin.scaledSize=new google.maps.Size(this._options.markerIcons.pin.sizes.x,this._options.markerIcons.pin.sizes.y),this._options.markerIcons.pinAlt.scaledSize=new google.maps.Size(this._options.markerIcons.pinAlt.sizes.x,this._options.markerIcons.pinAlt.sizes.y),this._options.markerIcons.pinActive.scaledSize=new google.maps.Size(this._options.markerIcons.pinActive.sizes.x,this._options.markerIcons.pinActive.sizes.y),this._options.markerIcons.userLocation.scaledSize=new google.maps.Size(this._options.markerIcons.userLocation.sizes.x,this._options.markerIcons.userLocation.sizes.y)},t.prototype._attachMapListeners=function(){google.maps.event.addListener(this.map,"bounds_changed",this.mapChangeHandler.bind(this)),google.maps.event.addListener(this.map,"zoom_changed",this.zoomChangeHandler.bind(this))},t.prototype._attachEvents=function(){var t=this;this._$sidebarToggler.on("click",this.toggleSidebar.bind(this)),this._$locationButton.on("click",this.locationButtonClickHandler.bind(this)),this._$searchButton.on("click",this.searchButtonClickHandler.bind(this)),this._$searchForm.on("submit",function(e){e.preventDefault();var o=r(".cs-store-locator__search-item.selected").length?r(".cs-store-locator__search-item.selected"):null;o&&t._$searchInput.val(o.text()),t.searchButtonClickHandler()}),this._$element.on("click",function(e){r(e.target).hasClass("cs-store-locator__item-hours-trigger")&&r(e.target).next().toggle(),r(e.target).hasClass("cs-store-locator__store-details-close")&&t.closeMobilePopup()}),window.addEventListener("resize",this.windowResizeHandler.bind(this)),window.addEventListener("orientationchange",function(){t.orientationChanged().then(function(){setTimeout(function(){t.windowResizeHandler()},20)})})},t}();e.default=l},273:function(t,e,o){"use strict";o.r(e),e.default=[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#46bcec"},{visibility:"on"}]}]},274:function(t,e,o){"use strict";
/**
 * @license
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function s(t,e,o){this.extend(s,google.maps.OverlayView),this.map_=t,this.markers_=[],this.clusters_=[],this.sizes=[53,56,66,78,90],this.styles_=[],this.ready_=!1;var r=o||{};this.gridSize_=r.gridSize||60,this.minClusterSize_=r.minimumClusterSize||2,this.maxZoom_=r.maxZoom||null,this.styles_=r.styles||[],this.imagePath_=r.imagePath||this.MARKER_CLUSTER_IMAGE_PATH_,this.imageExtension_=r.imageExtension||this.MARKER_CLUSTER_IMAGE_EXTENSION_,this.zoomOnClick_=!0,null!=r.zoomOnClick&&(this.zoomOnClick_=r.zoomOnClick),this.averageCenter_=!1,null!=r.averageCenter&&(this.averageCenter_=r.averageCenter),this.setupStyles_(),this.setMap(t),this.prevZoom_=this.map_.getZoom();var i=this;google.maps.event.addListener(this.map_,"zoom_changed",function(){var t=i.map_.getZoom(),e=i.map_.minZoom||0,o=Math.min(i.map_.maxZoom||100,21);t=Math.min(Math.max(t,e),o),i.prevZoom_!=t&&(i.prevZoom_=t,i.resetViewport())}),google.maps.event.addListener(this.map_,"idle",function(){i.redraw()}),e&&(e.length||Object.keys(e).length)&&this.addMarkers(e,!1)}function r(t){this.markerClusterer_=t,this.map_=t.getMap(),this.gridSize_=t.getGridSize(),this.minClusterSize_=t.getMinClusterSize(),this.averageCenter_=t.isAverageCenter(),this.center_=null,this.markers_=[],this.bounds_=null,this.clusterIcon_=new i(this,t.getStyles(),t.getGridSize())}function i(t,e,o){t.getMarkerClusterer().extend(i,google.maps.OverlayView),this.styles_=e,this.padding_=o||0,this.cluster_=t,this.center_=null,this.map_=t.getMap(),this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(this.map_)}o.r(e),s.prototype.MARKER_CLUSTER_IMAGE_PATH_="../images/m",s.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_="png",s.prototype.extend=function(t,e){return function(t){for(var e in t.prototype)this.prototype[e]=t.prototype[e];return this}.apply(t,[e])},s.prototype.onAdd=function(){this.setReady_(!0)},s.prototype.draw=function(){},s.prototype.setupStyles_=function(){if(!this.styles_.length)for(var t,e=0;t=this.sizes[e];e++)this.styles_.push({url:this.imagePath_+(e+1)+"."+this.imageExtension_,height:t,width:t})},s.prototype.fitMapToMarkers=function(){for(var t,e=this.getMarkers(),o=new google.maps.LatLngBounds,s=0;t=e[s];s++)o.extend(t.getPosition());this.map_.fitBounds(o)},s.prototype.setStyles=function(t){this.styles_=t},s.prototype.getStyles=function(){return this.styles_},s.prototype.isZoomOnClick=function(){return this.zoomOnClick_},s.prototype.isAverageCenter=function(){return this.averageCenter_},s.prototype.getMarkers=function(){return this.markers_},s.prototype.getTotalMarkers=function(){return this.markers_.length},s.prototype.setMaxZoom=function(t){this.maxZoom_=t},s.prototype.getMaxZoom=function(){return this.maxZoom_},s.prototype.calculator_=function(t,e){for(var o=0,s=t.length,r=s;0!==r;)r=parseInt(r/10,10),o++;return{text:s,index:o=Math.min(o,e)}},s.prototype.setCalculator=function(t){this.calculator_=t},s.prototype.getCalculator=function(){return this.calculator_},s.prototype.addMarkers=function(t,e){if(t.length)for(var o=0;s=t[o];o++)this.pushMarkerTo_(s);else if(Object.keys(t).length)for(var s in t)this.pushMarkerTo_(t[s]);e||this.redraw()},s.prototype.pushMarkerTo_=function(t){if(t.isAdded=!1,t.draggable){var e=this;google.maps.event.addListener(t,"dragend",function(){t.isAdded=!1,e.repaint()})}this.markers_.push(t)},s.prototype.addMarker=function(t,e){this.pushMarkerTo_(t),e||this.redraw()},s.prototype.removeMarker_=function(t){var e=-1;if(this.markers_.indexOf)e=this.markers_.indexOf(t);else for(var o,s=0;o=this.markers_[s];s++)if(o==t){e=s;break}return-1!=e&&(t.setMap(null),this.markers_.splice(e,1),!0)},s.prototype.removeMarker=function(t,e){var o=this.removeMarker_(t);return!(e||!o)&&(this.resetViewport(),this.redraw(),!0)},s.prototype.removeMarkers=function(t,e){for(var o,s=t===this.getMarkers()?t.slice():t,r=!1,i=0;o=s[i];i++){var n=this.removeMarker_(o);r=r||n}if(!e&&r)return this.resetViewport(),this.redraw(),!0},s.prototype.setReady_=function(t){this.ready_||(this.ready_=t,this.createClusters_())},s.prototype.getTotalClusters=function(){return this.clusters_.length},s.prototype.getMap=function(){return this.map_},s.prototype.setMap=function(t){this.map_=t},s.prototype.getGridSize=function(){return this.gridSize_},s.prototype.setGridSize=function(t){this.gridSize_=t},s.prototype.getMinClusterSize=function(){return this.minClusterSize_},s.prototype.setMinClusterSize=function(t){this.minClusterSize_=t},s.prototype.getExtendedBounds=function(t){var e=this.getProjection(),o=new google.maps.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()),s=new google.maps.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()),r=e.fromLatLngToDivPixel(o);r.x+=this.gridSize_,r.y-=this.gridSize_;var i=e.fromLatLngToDivPixel(s);i.x-=this.gridSize_,i.y+=this.gridSize_;var n=e.fromDivPixelToLatLng(r),a=e.fromDivPixelToLatLng(i);return t.extend(n),t.extend(a),t},s.prototype.isMarkerInBounds_=function(t,e){return e.contains(t.getPosition())},s.prototype.clearMarkers=function(){this.resetViewport(!0),this.markers_=[]},s.prototype.resetViewport=function(t){for(var e,o=0;e=this.clusters_[o];o++)e.remove();var s;for(o=0;s=this.markers_[o];o++)s.isAdded=!1,t&&s.setMap(null);this.clusters_=[]},s.prototype.repaint=function(){var t=this.clusters_.slice();this.clusters_.length=0,this.resetViewport(),this.redraw(),n.setTimeout(function(){for(var e,o=0;e=t[o];o++)e.remove()},0)},s.prototype.redraw=function(){this.createClusters_()},s.prototype.distanceBetweenPoints_=function(t,e){if(!t||!e)return 0;var o=(e.lat()-t.lat())*Math.PI/180,s=(e.lng()-t.lng())*Math.PI/180,r=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t.lat()*Math.PI/180)*Math.cos(e.lat()*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))},s.prototype.addToClosestCluster_=function(t){for(var e,o=4e4,s=null,i=(t.getPosition(),0);e=this.clusters_[i];i++){var n=e.getCenter();if(n){var a=this.distanceBetweenPoints_(n,t.getPosition());a<o&&(o=a,s=e)}}s&&s.isMarkerInClusterBounds(t)?s.addMarker(t):((e=new r(this)).addMarker(t),this.clusters_.push(e))},s.prototype.createClusters_=function(){if(this.ready_)for(var t,e=new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),this.map_.getBounds().getNorthEast()),o=this.getExtendedBounds(e),s=0;t=this.markers_[s];s++)!t.isAdded&&this.isMarkerInBounds_(t,o)&&this.addToClosestCluster_(t)},r.prototype.isMarkerAlreadyAdded=function(t){if(this.markers_.indexOf)return-1!=this.markers_.indexOf(t);for(var e,o=0;e=this.markers_[o];o++)if(e==t)return!0;return!1},r.prototype.addMarker=function(t){if(this.isMarkerAlreadyAdded(t))return!1;if(this.center_){if(this.averageCenter_){var e=this.markers_.length+1,o=(this.center_.lat()*(e-1)+t.getPosition().lat())/e,s=(this.center_.lng()*(e-1)+t.getPosition().lng())/e;this.center_=new google.maps.LatLng(o,s),this.calculateBounds_()}}else this.center_=t.getPosition(),this.calculateBounds_();t.isAdded=!0,this.markers_.push(t);var r=this.markers_.length;if(r<this.minClusterSize_&&t.getMap()!=this.map_&&t.setMap(this.map_),r==this.minClusterSize_)for(var i=0;i<r;i++)this.markers_[i].setMap(null);return r>=this.minClusterSize_&&t.setMap(null),this.updateIcon(),!0},r.prototype.getMarkerClusterer=function(){return this.markerClusterer_},r.prototype.getBounds=function(){for(var t,e=new google.maps.LatLngBounds(this.center_,this.center_),o=this.getMarkers(),s=0;t=o[s];s++)e.extend(t.getPosition());return e},r.prototype.remove=function(){this.clusterIcon_.remove(),this.markers_.length=0,delete this.markers_},r.prototype.getSize=function(){return this.markers_.length},r.prototype.getMarkers=function(){return this.markers_},r.prototype.getCenter=function(){return this.center_},r.prototype.calculateBounds_=function(){var t=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(t)},r.prototype.isMarkerInClusterBounds=function(t){return this.bounds_.contains(t.getPosition())},r.prototype.getMap=function(){return this.map_},r.prototype.updateIcon=function(){var t=this.map_.getZoom(),e=this.markerClusterer_.getMaxZoom();if(e&&t>e)for(var o,s=0;o=this.markers_[s];s++)o.setMap(this.map_);else if(this.markers_.length<this.minClusterSize_)this.clusterIcon_.hide();else{var r=this.markerClusterer_.getStyles().length,i=this.markerClusterer_.getCalculator()(this.markers_,r);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.setSums(i),this.clusterIcon_.show()}},i.prototype.triggerClusterClick=function(){var t=this.cluster_.getMarkerClusterer();google.maps.event.trigger(t.map_,"clusterclick",this.cluster_),t.isZoomOnClick()&&this.map_.fitBounds(this.cluster_.getBounds())},i.prototype.onAdd=function(){if(this.div_=document.createElement("DIV"),this.visible_){var t=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(t),this.div_.innerHTML=this.sums_.text}this.getPanes().overlayMouseTarget.appendChild(this.div_);var e=this;google.maps.event.addDomListener(this.div_,"click",function(){e.triggerClusterClick()})},i.prototype.getPosFromLatLng_=function(t){var e=this.getProjection().fromLatLngToDivPixel(t);return e.x-=parseInt(this.width_/2,10),e.y-=parseInt(this.height_/2,10),e},i.prototype.draw=function(){if(this.visible_){var t=this.getPosFromLatLng_(this.center_);this.div_.style.top=t.y+"px",this.div_.style.left=t.x+"px",this.div_.style.zIndex=google.maps.Marker.MAX_ZINDEX+1}},i.prototype.hide=function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1},i.prototype.show=function(){if(this.div_){var t=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(t),this.div_.style.display=""}this.visible_=!0},i.prototype.remove=function(){this.setMap(null)},i.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),this.div_.parentNode.removeChild(this.div_),this.div_=null)},i.prototype.setSums=function(t){this.sums_=t,this.text_=t.text,this.index_=t.index,this.div_&&(this.div_.innerHTML=t.text),this.useStyle()},i.prototype.useStyle=function(){var t=Math.max(0,this.sums_.index-1);t=Math.min(this.styles_.length-1,t);var e=this.styles_[t];this.url_=e.url,this.height_=e.height,this.width_=e.width,this.textColor_=e.textColor,this.anchor_=e.anchor,this.textSize_=e.textSize,this.backgroundPosition_=e.backgroundPosition},i.prototype.setCenter=function(t){this.center_=t},i.prototype.createCss=function(t){var e=[];e.push("background-image:url("+this.url_+");");var o=this.backgroundPosition_?this.backgroundPosition_:"0 0";e.push("background-position:"+o+";"),"object"==typeof this.anchor_?("number"==typeof this.anchor_[0]&&this.anchor_[0]>0&&this.anchor_[0]<this.height_?e.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):e.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),"number"==typeof this.anchor_[1]&&this.anchor_[1]>0&&this.anchor_[1]<this.width_?e.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):e.push("width:"+this.width_+"px; text-align:center;")):e.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");var s=this.textColor_?this.textColor_:"black",r=this.textSize_?this.textSize_:11;return e.push("cursor:pointer; top:"+t.y+"px; left:"+t.x+"px; color:"+s+"; position:absolute; font-size:"+r+"px; font-family:Arial,sans-serif; font-weight:bold"),e.join("")};var n=n||{};n.MarkerClusterer=s,s.prototype.addMarker=s.prototype.addMarker,s.prototype.addMarkers=s.prototype.addMarkers,s.prototype.clearMarkers=s.prototype.clearMarkers,s.prototype.fitMapToMarkers=s.prototype.fitMapToMarkers,s.prototype.getCalculator=s.prototype.getCalculator,s.prototype.getGridSize=s.prototype.getGridSize,s.prototype.getExtendedBounds=s.prototype.getExtendedBounds,s.prototype.getMap=s.prototype.getMap,s.prototype.getMarkers=s.prototype.getMarkers,s.prototype.getMaxZoom=s.prototype.getMaxZoom,s.prototype.getStyles=s.prototype.getStyles,s.prototype.getTotalClusters=s.prototype.getTotalClusters,s.prototype.getTotalMarkers=s.prototype.getTotalMarkers,s.prototype.redraw=s.prototype.redraw,s.prototype.removeMarker=s.prototype.removeMarker,s.prototype.removeMarkers=s.prototype.removeMarkers,s.prototype.resetViewport=s.prototype.resetViewport,s.prototype.repaint=s.prototype.repaint,s.prototype.setCalculator=s.prototype.setCalculator,s.prototype.setGridSize=s.prototype.setGridSize,s.prototype.setMaxZoom=s.prototype.setMaxZoom,s.prototype.onAdd=s.prototype.onAdd,s.prototype.draw=s.prototype.draw,r.prototype.getCenter=r.prototype.getCenter,r.prototype.getSize=r.prototype.getSize,r.prototype.getMarkers=r.prototype.getMarkers,i.prototype.onAdd=i.prototype.onAdd,i.prototype.draw=i.prototype.draw,i.prototype.onRemove=i.prototype.onRemove,Object.keys=Object.keys||function(t){var e=[];for(var o in t)t.hasOwnProperty(o)&&e.push(o);return e},e.default=s},4:function(t,o){t.exports=e}})});